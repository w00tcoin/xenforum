/**
* Prestashop Addons | Module by: <App1Pro>
*
* @author    Chuyen Nguyen [App1Pro].
* @copyright Chuyenim@gmail.com
* @license   http://app1pro.com/license.txt
*/

(function(d){var p=window.define;"function"===typeof p&&p.amd?p(["jquery","jquery-ui/sortable"],d):d(window.jQuery)})(function(d){function p(a,c,d){return a>c&&a<c+d}d.widget("mjs.nestedSortable",d.extend({},d.ui.sortable.prototype,{options:{disableParentChange:!1,doNotClear:!1,expandOnHover:700,isAllowed:function(){return!0},isTree:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,startCollapsed:!1,tabSize:20,branchClass:"mjs-nestedSortable-branch",collapsedClass:"mjs-nestedSortable-collapsed",
disableNestingClass:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",expandedClass:"mjs-nestedSortable-expanded",hoveringClass:"mjs-nestedSortable-hovering",leafClass:"mjs-nestedSortable-leaf",disabledClass:"mjs-nestedSortable-disabled"},_create:function(){var a=this;this.element.data("ui-sortable",this.element.data("mjs-nestedSortable"));if(!this.element.is(this.options.listType))throw Error("nestedSortable: Please check that the listType option is set to your actual list type");
this.options.isTree&&this.options.expandOnHover&&(this.options.tolerance="intersect");d.ui.sortable.prototype._create.apply(this,arguments);this.options.isTree&&d(this.items).each(function(){var c=this.item,d=c.hasClass(a.options.collapsedClass),e=c.hasClass(a.options.expandedClass);c.children(a.options.listType).length?(c.addClass(a.options.branchClass),d||e||(a.options.startCollapsed?c.addClass(a.options.collapsedClass):c.addClass(a.options.expandedClass))):c.addClass(a.options.leafClass)})},_destroy:function(){this.element.removeData("mjs-nestedSortable").removeData("ui-sortable");
return d.ui.sortable.prototype._destroy.apply(this,arguments)},_mouseDrag:function(a){var c,f,e,g,n=this,b=this.options,h=!1,l=d(document),m,p,r,t,k,q;this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-a.pageY<b.scrollSensitivity?(h=this.scrollParent.scrollTop()+
b.scrollSpeed,this.scrollParent.scrollTop(h)):a.pageY-this.overflowOffset.top<b.scrollSensitivity&&(h=this.scrollParent.scrollTop()-b.scrollSpeed,this.scrollParent.scrollTop(h)),this.overflowOffset.left+this.scrollParent[0].offsetWidth-a.pageX<b.scrollSensitivity?(h=this.scrollParent.scrollLeft()+b.scrollSpeed,this.scrollParent.scrollLeft(h)):a.pageX-this.overflowOffset.left<b.scrollSensitivity&&(h=this.scrollParent.scrollLeft()-b.scrollSpeed,this.scrollParent.scrollLeft(h))):(a.pageY-l.scrollTop()<
b.scrollSensitivity?(h=l.scrollTop()-b.scrollSpeed,l.scrollTop(h)):d(window).height()-(a.pageY-l.scrollTop())<b.scrollSensitivity&&(h=l.scrollTop()+b.scrollSpeed,l.scrollTop(h)),a.pageX-l.scrollLeft()<b.scrollSensitivity?(h=l.scrollLeft()-b.scrollSpeed,l.scrollLeft(h)):d(window).width()-(a.pageX-l.scrollLeft())<b.scrollSensitivity&&(h=l.scrollLeft()+b.scrollSpeed,l.scrollLeft(h))),!1!==h&&d.ui.ddmanager&&!b.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a));this.positionAbs=this._convertPositionTo("absolute");
h=this.placeholder.offset().top;this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px");this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px");this.hovering=this.hovering?this.hovering:null;this.mouseentered=this.mouseentered?this.mouseentered:!1;(function(){var b=this.placeholder.parent().parent();b&&b.closest(".ui-sortable").length&&(m=b)}).call(this);l=this._getLevel(this.placeholder);p=this._getChildLevels(this.helper);
t=document.createElement(b.listType);for(c=this.items.length-1;0<=c;c--)if(f=this.items[c],e=f.item[0],(g=this._intersectsWithPointer(f))&&f.instance===this.currentContainer){if(-1!==e.className.indexOf(b.disabledClass))if(2===g){if((r=this.items[c+1])&&r.item.hasClass(b.disabledClass))continue}else if(1===g&&(r=this.items[c-1])&&r.item.hasClass(b.disabledClass))continue;r=1===g?"next":"prev";if(e!==this.currentItem[0]&&this.placeholder[r]()[0]!==e&&!d.contains(this.placeholder[0],e)&&("semi-dynamic"===
this.options.type?!d.contains(this.element[0],e):1)){this.mouseentered||(d(e).mouseenter(),this.mouseentered=!0);b.isTree&&d(e).hasClass(b.collapsedClass)&&b.expandOnHover&&!this.hovering&&(d(e).addClass(b.hoveringClass),this.hovering=window.setTimeout(function(){d(e).removeClass(b.collapsedClass).addClass(b.expandedClass);n.refreshPositions();n._trigger("expand",a,n._uiHash())},b.expandOnHover));this.direction=1===g?"down":"up";if("pointer"===this.options.tolerance||this._intersectsWithSides(f))d(e).mouseleave(),
this.mouseentered=!1,d(e).removeClass(b.hoveringClass),this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,!b.protectRoot||this.currentItem[0].parentNode===this.element[0]&&e.parentNode!==this.element[0]?b.protectRoot||this._rearrange(a,f):this.currentItem[0].parentNode!==this.element[0]&&e.parentNode===this.element[0]?(d(e).children(b.listType).length||(e.appendChild(t),b.isTree&&d(e).removeClass(b.leafClass).addClass(b.branchClass+" "+b.expandedClass)),c="down"===this.direction?
d(e).prev().children(b.listType):d(e).children(b.listType),void 0!==c[0]&&this._rearrange(a,null,c)):this._rearrange(a,f);else break;this._clearEmpty(e);this._trigger("change",a,this._uiHash());break}}(function(){var b=this.placeholder.prev();k=b.length?b:null}).call(this);if(null!=k)for(;"li"!==k[0].nodeName.toLowerCase()||-1!==k[0].className.indexOf(b.disabledClass)||k[0]===this.currentItem[0]||k[0]===this.helper[0];)if(k[0].previousSibling)k=d(k[0].previousSibling);else{k=null;break}(function(){var b=
this.placeholder.next();q=b.length?b:null}).call(this);if(null!=q)for(;"li"!==q[0].nodeName.toLowerCase()||-1!==q[0].className.indexOf(b.disabledClass)||q[0]===this.currentItem[0]||q[0]===this.helper[0];)if(q[0].nextSibling)q=d(q[0].nextSibling);else{q=null;break}this.beyondMaxLevels=0;null==m||null!=q||b.protectRoot&&m[0].parentNode==this.element[0]||!(b.rtl&&this.positionAbs.left+this.helper.outerWidth()>m.offset().left+m.outerWidth()||!b.rtl&&this.positionAbs.left<m.offset().left)?null==k||k.hasClass(b.disableNestingClass)||
!(k.children(b.listType).length&&k.children(b.listType).is(":visible")||!k.children(b.listType).length)||b.protectRoot&&this.currentItem[0].parentNode===this.element[0]||!(b.rtl&&this.positionAbs.left+this.helper.outerWidth()<k.offset().left+k.outerWidth()-b.tabSize||!b.rtl&&this.positionAbs.left>k.offset().left+b.tabSize)?this._isAllowed(m,l,l+p):(this._isAllowed(k,l,l+p+1),k.children(b.listType).length||(k[0].appendChild(t),b.isTree&&k.removeClass(b.leafClass).addClass(b.branchClass+" "+b.expandedClass)),
h&&h<=k.offset().top?k.children(b.listType).prepend(this.placeholder):k.children(b.listType)[0].appendChild(this.placeholder[0]),"undefined"!==typeof m&&this._clearEmpty(m[0]),this._trigger("change",a,this._uiHash())):(m.after(this.placeholder[0]),h=!m.children(b.listItem).children("li:visible:not(.ui-sortable-helper)").length,b.isTree&&h&&m.removeClass(this.options.branchClass+" "+this.options.expandedClass).addClass(this.options.leafClass),"undefined"!==typeof m&&this._clearEmpty(m[0]),this._trigger("change",
a,this._uiHash()));this._contactContainers(a);d.ui.ddmanager&&d.ui.ddmanager.drag(this,a);this._trigger("sort",a,this._uiHash());this.lastPositionAbs=this.positionAbs;return!1},_mouseStop:function(a){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?d(this.domPosition.prev).after(this.placeholder):d(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",a,this._uiHash()));d("."+this.options.hoveringClass).mouseleave().removeClass(this.options.hoveringClass);
this.mouseentered=!1;this.hovering&&window.clearTimeout(this.hovering);this.hovering=null;this._relocate_event=a;this._pid_current=d(this.domPosition.parent).parent().attr("id");this._sort_current=this.domPosition.prev?d(this.domPosition.prev).next().index():0;d.ui.sortable.prototype._mouseStop.apply(this,arguments)},_intersectsWithSides:function(a){var c=this.options.isTree?.8:.5,d=p(this.positionAbs.top+this.offset.click.top,a.top+a.height*c,a.height),c=p(this.positionAbs.top+this.offset.click.top,
a.top-a.height*c,a.height);a=p(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width);var e=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return this.floating&&g?"right"===g&&a||"left"===g&&!a:e&&("down"===e&&d||"up"===e&&c)},_contactContainers:function(){this.options.protectRoot&&this.currentItem[0].parentNode===this.element[0]||d.ui.sortable.prototype._contactContainers.apply(this,arguments)},_clear:function(){var a,c;d.ui.sortable.prototype._clear.apply(this,
arguments);this._pid_current===this._uiHash().item.parent().parent().attr("id")&&this._sort_current===this._uiHash().item.index()||this._trigger("relocate",this._relocate_event,this._uiHash());for(a=this.items.length-1;0<=a;a--)c=this.items[a].item[0],this._clearEmpty(c)},serialize:function(a){var c=d.extend({},this.options,a);a=this._getItemsAsjQuery(c&&c.connected);var f=[];d(a).each(function(){var a=(d(c.item||this).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/),g=(d(c.item||
this).parent(c.listType).parent(c.items).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/);a&&f.push((c.key||a[1])+"["+(c.key&&c.expression?a[1]:a[2])+"]="+(g?c.key&&c.expression?g[1]:g[2]:c.rootID))});!f.length&&c.key&&f.push(c.key+"=");return f.join("&")},toHierarchy:function(a){function c(a){var e=(d(a).attr(f.attribute||"id")||"").match(f.expression||/(.+)[-=_](.+)/),b;if(e)return b={id:e[2]},0<d(a).children(f.listType).children(f.items).length&&(b.children=[],d(a).children(f.listType).children(f.items).each(function(){var a=
c(this);b.children.push(a)})),b}var f=d.extend({},this.options,a),e=[];d(this.element).children(f.items).each(function(){var a=c(this);e.push(a)});return e},toArray:function(a){function c(a,h,l){var m=l+1,n;0<d(a).children(f.listType).children(f.items).length&&(h++,d(a).children(f.listType).children(f.items).each(function(){m=c(d(this),h,m)}),h--);n=d(a).attr(f.attribute||"id").match(f.expression||/(.+)[-=_](.+)/);h===e+1?a=f.rootID:(a=d(a).parent(f.listType).parent(f.items).attr(f.attribute||"id").match(f.expression||
/(.+)[-=_](.+)/),a=a[2]);n&&g.push({item_id:n[2],parent_id:a,depth:h,left:l,right:m});return m+1}var f=d.extend({},this.options,a),e=f.startDepthCount||0,g=[],n=1;f.excludeRoot||(g.push({item_id:f.rootID,parent_id:null,depth:e,left:n,right:2*(d(f.items,this.element).length+1)}),n++);d(this.element).children(f.items).each(function(){n=c(this,e+1,n)});return g=g.sort(function(a,c){return a.left-c.left})},_clearEmpty:function(a){var c=this.options,f=d(a).children(c.listType),e=f.is(":not(:empty)"),g=
c.doNotClear||e||c.protectRoot&&d(a)[0]===this.element[0];if(c.isTree){var n=c.branchClass,b=c.leafClass;g&&(n=[b,b=n][0]);d(a).removeClass(n).addClass(b);g&&e&&(e=c.collapsedClass,c=c.expandedClass,d(a).removeClass(e).addClass(c))}g||f.remove()},_getLevel:function(a){var c=1;if(this.options.listType)for(a=a.closest(this.options.listType);a&&0<a.length&&!a.is(".ui-sortable");)c++,a=a.parent().closest(this.options.listType);return c},_getChildLevels:function(a,c){var f=this,e=this.options,g=0;c=c||
0;d(a).children(e.listType).children(e.items).each(function(a,b){g=Math.max(f._getChildLevels(b,c+1),g)});return c?g+1:g},_isAllowed:function(a,c,d){c=this.options;var e=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels"),g=this.currentItem.parent().parent();c.disableParentChange&&("undefined"!==typeof a&&!g.is(a)||"undefined"===typeof a&&g.is("li"))||!c.isAllowed(this.placeholder,a,this.currentItem)?(this.placeholder.addClass(c.errorClass),this.beyondMaxLevels=e<d&&0!==
e?d-e:1):e<d&&0!==e?(this.placeholder.addClass(c.errorClass),this.beyondMaxLevels=d-e):(this.placeholder.removeClass(c.errorClass),this.beyondMaxLevels=0)}}));d.mjs.nestedSortable.prototype.options=d.extend({},d.ui.sortable.prototype.options,d.mjs.nestedSortable.prototype.options)});